# GSAP ScrollTrigger チートシート

このドキュメントは、GSAPの`ScrollTrigger`プラグインの主要なプロパティに関する会話の要点をまとめたものです。

## 1. `scrub` プロパティ

スクロールとアニメーションを直接連動させるためのプロパティです。スクロールバーがアニメーションの再生ヘッドのようになります。

-   **`scrub: false` (デフォルト)**
    -   アニメーションはトリガー(`start`)に到達した瞬間に一度だけ再生されます。

-   **`scrub: true`**
    -   スクロール位置とアニメーションが1:1で同期します。
    -   スクロールを止めるとアニメーションも止まり、逆スクロールするとアニメーションも逆再生されます。
    -   動きが少し硬い（機械的）印象になることがあります。

-   **`scrub: <number>` (例: `scrub: 1`)**
    -   `true`の動作を滑らかにします。数値は「追いつくまでの時間（秒）」を表します。
    -   ユーザーの急なスクロール操作にも、アニメーションが優雅に追従するようになります。実案件で最もよく使われる形式です。

---

## 2. `start` / `end` プロパティ

アニメーションが**いつ開始し、いつ終了するか**を定義します。

### 書式

`"[トリガーのどの部分] [ビューポートのどの部分]"`

-   **第1キーワード (トリガー側)**: `trigger`で指定した要素のどの部分か (`top`, `center`, `bottom`)
-   **第2キーワード (ビューポート側)**: ブラウザ表示領域のどの部分か (`top`, `center`, `bottom`)

### 例

-   `start: "top center"`
    -   意味: トリガー要素の**上辺**が、ビューポートの**中央**に到達したとき。
-   `end: "bottom top"`
    -   意味: トリガー要素の**下辺**が、ビューポートの**上辺**に到達したとき。

---

## 3. 絶対指定と相対指定

`start`と`end`には、絶対的な位置と相対的な距離の両方を指定でき、これが混乱の元になりやすいです。

-   **絶対指定 (キーワードや`px`, `%`)**
    -   **例**: `end: "top 100px"`
    -   **意味**: ビューポート（画面）を基準にした絶対的な位置を指定します。「ビューポートの上から100pxの位置」など。
    -   **ユースケース**: 特定のレイアウトや見た目（例: 「画面中央に来たら」）を基準にしたい場合に強力です。

-   **相対指定 (`+=`)**
    -   **例**: `end: "+=500"`
    -   **意味**: `start`の位置を基準にした相対的なスクロール距離を指定します。「start地点からさらに500px下にスクロールしたら」など。
    -   **ユースケース**: アニメーションの「長さ」や「尺」を基準にしたい場合に便利で、`start`/`end`の逆転が起こらないため安全です。

| 指定方法 | 基準 | ユースケース |
| :--- | :--- | :--- |
| **絶対指定** | レイアウト上の**「位置」** | 「画面中央に来たら開始」など |
| **相対指定** | アニメーションの**「長さ」** | 「500pxスクロールする間に実行」など |

---

## 4. よくあるハマりどころ: `start`/`end`の逆転

### 現象
アニメーションが全く動かない。

### 原因
`end`に指定したスクロール位置が、`start`に指定した位置よりも**手前**になっている。

### `start` / `end` の図解

`start`と`end`は、**トリガー要素**と**ビューポート（画面）** の2つの辺の位置関係で決まります。

#### `start: "top top"` の瞬間
これは `[トリガーの上辺] [ビューポートの上辺]` という意味です。
スクロールが進み、**トリガー要素の上辺**と**ビューポートの上辺**がピッタリ重なった瞬間が`start`です。

```
+----------------------+ <--- ビューポートの上辺
+------------------+ <--- トリガー要素の上辺 (ピッタリ重なる)
| |   トリガー要素   | |
| +------------------+ |
|                      |
+----------------------+
```

#### `end: "top 100px"` の瞬間 (逆転する例)
これは `[トリガーの上辺] [ビューポートの上から100px]` という意味です。
この状態は、`start: "top top"`の瞬間よりも**手前（スクロール位置が浅い場所）**で発生します。

```
+----------------------+ <--- ビューポートの上辺
|                      |
|----------------------| <--- ビューポートの上から100pxのライン
+------------------+ <--- トリガー要素の上辺 (ここに重なる)
| |   トリガー要素   | |
| +------------------+ |
+----------------------+
```

### 動かないコードの例
```javascript
// 動かないコードの例
scrollTrigger: {
    trigger: ".box",
    start: "top top",      // トリガー上辺がビューポート上辺 (0px) に来た時
    end: "top 100px",      // トリガー上辺がビューポート上から100pxの位置に来た時
    scrub: true
}
```
スクロールは上から下に進むため、「100px地点」を通過した**後**に「0px地点」を通過します。つまり、`end`が`start`より先に来てしまい、アニメーション区間が存在しないことになります。

### 解決策

1.  **相対指定`+=`を使う (推奨)**
    -   `end`を`start`からの相対距離で指定すれば、逆転は絶対に起こりません。
    -   `end: "+=500"` // start地点から500pxスクロールしたら終了

2.  **`markers: true`で常に確認する**
    -   開発中は`markers: true`を設定し、`start`と`end`の物理的な位置を常に画面上で確認する癖をつけると、間違いにすぐ気づけます。 